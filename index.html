<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>[SUP] Cadastro de Justificativas</title>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800;900&display=swap" rel="stylesheet"/>
    <link rel="icon" href="https://i.imgur.com/q7CcnFc.png" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: 'Poppins', sans-serif;
      }

      html {
        height: 100%;
        background-image: 
          linear-gradient(135deg, rgba(21, 127, 13, 0.85), rgba(26, 153, 15, 0.85), rgba(39, 174, 96, 0.85), rgba(26, 153, 15, 0.85)),
          url('https://i.imgur.com/eSWhRGw.png');
        background-size: 300% 300%, cover;
        background-position: center, center;
        background-attachment: fixed;
        animation: greenGradient 15s ease-in-out infinite;
      }

      @keyframes greenGradient {
        0% { background-position: 0% 50%, center; }
        50% { background-position: 100% 50%, center; }
        100% { background-position: 0% 50%, center; }
      }
      
      @keyframes pulseGlow {
        0%, 100% {
          filter: drop-shadow(0 0 5px rgba(150, 255, 150, 0.4));
          transform: scale(1);
        }
        50% {
          filter: drop-shadow(0 0 15px rgba(150, 255, 150, 0.8));
          transform: scale(1.03);
        }
      }

      body {
        background: transparent;
        color: #e8f5e9;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        padding: 30px 15px;
        min-height: 100vh;
        overflow-x: hidden;
        overflow-y: auto;
      }
      
      ::selection {
        background-color: #1a990f;
        color: #ffffff;
      }

      .container {
        max-width: 800px;
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
        z-index: 1;
      }
      
      .logo-container {
        margin-bottom: 0;
        animation: pulseGlow 4s ease-in-out infinite;
      }
      
      .logo {
        width: 100%;
        max-width: 150px;
        height: auto;
        border-radius: 15px;
      }

      .info-box {
        font-size: 14px;
        line-height: 1.7;
        color: rgba(255, 255, 255, 0.9);
        background: rgba(0, 0, 0, 0.15);
        backdrop-filter: blur(5px);
        padding: 20px 25px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        margin-top: 20px;
        text-align: left;
        max-width: 650px;
        width: 100%;
      }
      .info-box p { margin-bottom: 12px; }
      .info-box p:last-child { margin-bottom: 0; }
      .info-box strong { color: #ffffff; font-weight: 600; }
      .info-box a {
          color: #a5d6a7;
          font-weight: 600;
          text-decoration: none;
          transition: color 0.3s;
      }
      .info-box a:hover {
          color: #ffffff;
          text-decoration: underline;
      }

      #instructions-toggle {
        background-color: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: #e8f5e9;
        padding: 10px 15px;
        width: 100%;
        text-align: left;
        cursor: pointer;
        border-radius: 5px;
        font-weight: 600;
        font-size: 15px;
        margin-top: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: background-color 0.3s;
      }
      #instructions-toggle:hover {
        background-color: rgba(255, 255, 255, 0.2);
      }

      #collapsible-instructions {
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }
      #collapsible-instructions ul {
          list-style: none;
          padding: 0;
          margin: 0;
      }
      #collapsible-instructions li {
          margin-bottom: 10px;
          display: flex;
          align-items: flex-start;
      }
      #collapsible-instructions li i {
          margin-right: 10px;
          color: #a5d6a7;
          margin-top: 4px;
      }
      
      .form-wrapper {
        position: relative;
        width: 100%;
        max-width: 650px;
        margin: 0 auto;
      }

      .form-container {
        width: 100%;
        background: rgba(0, 40, 10, 0.2);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 12px;
        padding: 30px 35px;
        color: #e8f5e9;
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2);
      }

      .form-container h2 {
        text-align: center;
        margin-bottom: 30px;
        font-weight: 700;
        font-size: 26px;
        color: #fff;
        text-shadow: 0 2px 4px rgba(0,0,0,0.25);
      }
      
      form {
        display: flex;
        flex-direction: column;
        gap: 25px;
      }
      
      .input-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      
      .input-group label, legend {
        display: flex;
        align-items: center;
        gap: 8px;
        text-align: left;
        font-size: 14px;
        font-weight: 500;
        color: rgba(255, 255, 255, 0.9);
        padding-left: 5px;
      }

      .input-group label .icon, legend .icon {
        color: rgba(255, 255, 255, 0.7);
        width: 16px;
        text-align: center;
      }
      
      input, select, textarea {
        width: 100%;
        padding: 12px 15px;
        font-size: 14px;
        font-weight: 500;
        color: #e0e0e0;
        background: rgba(0, 0, 0, 0.25);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        transition: all 0.3s ease;
      }
      
      select option { background: #333; color: #fff; }

      input[type="date"], input[type="time"] { position: relative; }
      input[type="date"]::-webkit-calendar-picker-indicator,
      input[type="time"]::-webkit-calendar-picker-indicator {
        filter: invert(0.8);
        cursor: pointer;
      }
      .time-input-container { display: flex; gap: 15px; }
      .time-input-container > div { flex: 1; }
      
      textarea { min-height: 90px; resize: vertical; padding-top: 12px; }
      
      input:focus, select:focus, textarea:focus {
        outline: none;
        border-color: #27ae60;
        background: rgba(0, 0, 0, 0.3);
        box-shadow: 0 0 10px rgba(39, 174, 96, 0.5);
      }
      
      input::placeholder, textarea::placeholder { color: rgba(230, 230, 230, 0.7); opacity: 1; }
      
      fieldset {
        border: 1px solid rgba(255, 255, 255, 0.2);
        padding: 15px;
        margin: 0;
        border-radius: 8px;
        display: flex;
        flex-direction: column;  
        gap: 12px;
      }
      
      legend {
        padding: 0 10px;
        color: #fff;
        font-weight: 500;
        font-size: 14px;
        width: auto;
        margin-bottom: 5px;
        border: none;
        background: none;
      }

      .radio-group-container { display: flex; flex-direction: column; gap: 15px; }
      
      .radio-row {
          display: flex;
          align-items: center;
          gap: 15px;
      }
      .radio-row .student-label {
          flex-shrink: 0;
          width: 80px;
          text-align: right;
          font-weight: 600;
          font-size: 13px;
          color: rgba(255, 255, 255, 0.95);
      }
      .radio-row .options-container {
          display: flex;
          flex-grow: 1;
          gap: 10px;
      }
      .radio-row .options-container label {
          flex: 1;
      }

      .radio-button-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: flex-start;
        align-items: center;
      }
      
      .radio-button-container input[type="radio"], .options-container input[type="radio"] {
        display: none;
      }

      .radio-button-container label, .options-container label {
        text-align: center;
        padding: 10px 12px;
        border-radius: 8px;
        cursor: pointer;
        background: rgba(0, 0, 0, 0.25);
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
        font-weight: 500;
        font-size: 13px;
        min-width: 80px;
        color: rgba(255, 255, 255, 0.8);
      }

      #acompanhamento-tutor-fieldset .radio-button-container {
        gap: 15px;
      }
      #acompanhamento-tutor-fieldset .radio-button-container label {
        flex: 1;
        font-size: 14px;
        padding: 12px;
      }


      .radio-button-container label:hover, .options-container label:hover {
        background: rgba(0, 0, 0, 0.4);
        border-color: rgba(255, 255, 255, 0.4);
      }

      .radio-button-container input[type="radio"]:checked + label,
      .options-container input[type="radio"]:checked + label {
        background-color: #1a990f;
        border-color: #27ae60;
        color: #fff;
        font-weight: 600;
        box-shadow: 0 0 10px rgba(39, 174, 96, 0.5);
      }

      .options-container input[value="Aprovado"]:checked + label { background-color: #28a745; border-color: #2ecc71; }
      .options-container input[value="Reprovado"]:checked + label { background-color: #dc3545; border-color: #e74c3c; }
      .options-container input[value="Caiu durante a aplicação da aula;"]:checked + label { background-color: #e8711c; border-color: #f39c12; }
      .options-container input[value="-x-"]:checked + label { background-color: #6c757d; border-color: #868e96; }


      button[type="submit"] {
        display: flex; align-items: center; justify-content: center; gap: 10px;
        padding: 12px 20px; font-size: 16px; font-weight: 700;
        color: #0c4a08; background: #ffffff;
        border: none; border-radius: 10px;
        transition: all 0.3s ease-in-out;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        cursor: pointer; text-transform: uppercase; letter-spacing: 0.8px;
        margin-top: 10px;
      }

      button[type="submit"]:hover, button[type="submit"]:focus {
        transform: translateY(-3px) scale(1.02);
        background: #fff;
        box-shadow: 0 0 18px rgba(150, 255, 150, 0.6), 0 6px 18px rgba(0, 0, 0, 0.2);
        outline: none;
      }
      
      button[type="submit"]:disabled {
        background-color: #ccc !important; color: #666 !important;
        cursor: not-allowed; transform: none; box-shadow: none;
      }

      input.invalid, select.invalid, textarea.invalid { border-color: #f44336 !important; }
      fieldset.invalid { border-color: #f44336 !important; }
      fieldset.invalid legend { color: #f44336 !important; }
      
      .credits {
        font-size: 13px; line-height: 1.6; color: rgba(255, 255, 255, 0.85);
        background: rgba(0, 0, 0, 0.15); backdrop-filter: blur(5px);
        padding: 15px 25px; border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        margin-top: 20px; text-align: center;
      }
      .credits p { margin-bottom: 5px; }
      .credits p:last-child { margin-bottom: 0; }
      .credits strong { color: #ffffff; font-weight: 600; }
      .credits i { margin-right: 8px; }

      @media (max-width: 768px) {
        body { padding: 20px 10px; }
        .logo { max-width: 120px; }
        .form-container { padding: 25px 20px; }
        .info-box { padding: 20px; }
        .time-input-container { flex-direction: column; }
        .radio-row { flex-direction: column; align-items: flex-start; }
        .radio-row .student-label { text-align: left; margin-bottom: 8px; width: auto;}
        .radio-row .options-container { width: 100%;}
      }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo-container">
            <img src="https://i.imgur.com/q7CcnFc.png" alt="Logo Supervisores" class="logo" />
        </div>

        <div class="info-box">
            <p>Este formulário tem como propósito justificar o motivo pelo qual não cumpriu as metas estabelecidas pela companhia dos Supervisores, a fim de ficar imune de punições previstas de acordo com o CCS em caso de falta sem motivos apresentados plausíveis. 

Qualquer dúvida, procure um membro do ministério e/ou liderança.</p>
           
        </div>

        <div class="form-wrapper">
            <div id="supervisor-system-form" class="form-container">
                <h2>[SUP] Cadastro de Justificativas</h2>
                <form id="supervisor-form" novalidate>
                    <div class="input-group">
                        <label for="supervisor"><i class="icon fas fa-user-shield"></i>Seu Nickname (Supervisor)</label>
                        <input type="text" id="supervisor" name="supervisor" placeholder="Insira seu nickname. Ex: fulano123" required />
                    </div>
                    <div class="input-group">
                        <label for="aula-aplicada"><i class="icon fas fa-chalkboard-teacher"></i>Cargo</label>
                        <select id="aula-aplicada" name="aula-aplicada" required>
                            <option value="" disabled selected>Selecione o seu cargo na companhia</option>
                            <option value="Supervisor">Supervisor</option>
                            <option value="Tutor">Tutor</option>
                            <option value="Fiscalizador">Fiscalizador</option>
                            <option value="Graduador">Graduador</option>
                        </select>
                    </div>
                  
                    <div class="input-group">
                        <label for="data-inicio"><i class="icon fas fa-calendar-alt"></i>Data (Insira a data do compromisso, atente-se ao selecionar).</label>
                        <div class="time-input-container">
                            <div><input type="date" id="data-inicio" name="data-inicio" required /></div>
                        </div>
                    </div>

                   
                    <div class="input-group">
                        <label for="comentarios"><i class="icon fas fa-comment-dots"></i>Motivo</label>
                        <textarea id="comentarios" name="comentarios" placeholder="Escreva o motivo pelo qual você não conseguiu cumprir a meta."></textarea>
                    </div>
                    
                    <button type="submit" id="submit-button">
                        <i class="fas fa-paper-plane"></i>
                        Enviar Justificativa
                    </button>
                </form>
            </div>
        </div>

        <div class="credits">
            <p><i class="fas fa-code"></i> Desenvolvimento: <strong>Pegas</strong></p>
            <p><i class="far fa-copyright"></i> Todos os direitos reservados à <strong>Companhia dos Supervisores.</strong></p>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js"></script>
    <script>
        $(document).ready(function() {
            const SPREADSHEET_REDIRECT_URL = 'https://docs.google.com/spreadsheets/d/15olIMB0HWvA36xvliBX4_eR_JIxOkL19rZ07Rtx0D6o/edit?gid=949553559#gid=949553559';
            const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyA2Bg4WDW0gO1shT69cfEWx2oeltkQNw1x9jqdgh2AMekN8WDgOe6zH1IhE_f1B-qJ/exec"; 

            $('#instructions-toggle').on('click', function() {
                const icon = $(this).find('i');
                icon.toggleClass('fa-chevron-down fa-chevron-up');
                $('#collapsible-instructions').slideToggle();
            });

            $('#alunos').on('input', function() {
                const studentNames = $(this).val().split('/').map(name => name.trim()).filter(name => name.length > 0);
                let studentCount = studentNames.length;
                if(studentCount === 0 && $(this).val().trim() !== '') studentCount = 1;
                if($(this).val().trim() === '') studentCount = 0;


                for (let i = 1; i <= 4; i++) {
                    const studentRow = $(`#aluno-${i}-row`);
                    const radios = $(`input[name="resultado-aluno${i}"]`);

                    if (i <= studentCount) {
                        if (!studentRow.is(':visible')) {
                            radios.prop('checked', false); 
                        }
                        studentRow.slideDown();
                    } else {
                        studentRow.slideUp();
                        radios.filter('[value="-x-"]').prop('checked', true);
                    }
                }
                 if (studentCount === 0) {
                      $('.radio-row').slideUp();
                 }
            }).trigger('input'); 

            $('#aula-aplicada').on('change', function() {
                if ($(this).val() === 'Supervisão de Soldados') {
                    $('#etapa-confirmacao-group').slideDown();
                    $('#etapa-confirmacao-fieldset').attr('data-required', 'true');
                } else {
                    $('#etapa-confirmacao-group').slideUp();
                    $('#etapa-confirmacao-fieldset').removeAttr('data-required');
                }
            });

            $('input[name^="resultado-aluno"]').on('change', function() {
                let showProvaQueda = false;
                $('input[name^="resultado-aluno"]:checked').each(function() {
                    if ($(this).val() === 'Caiu durante a aplicação da aula;' && $(this).closest('.radio-row').is(':visible')) {
                        showProvaQueda = true;
                    }
                });

                if (showProvaQueda) {
                    $('#prova-queda-group').slideDown();
                    $('#prova-queda').prop('required', true);
                } else {
                    $('#prova-queda-group').slideUp();
                    $('#prova-queda').prop('required', false);
                }
            });

            $('#supervisor-form').on('submit', function(event) {
                event.preventDefault();
                const form = $(this);
                const submitButton = $('#submit-button');
                
                let isValid = true;
                
                form.find('input[required], select[required], textarea[required]').each(function() {
                    const field = $(this);
                    field.removeClass('invalid');
                    if (field.is(':visible') && (!field.val() || field.val().trim() === "")) {
                       field.addClass('invalid');
                       isValid = false;
                    }
                });
                
                form.find('fieldset[data-required="true"]').each(function() {
                    const fieldset = $(this);
                    fieldset.removeClass('invalid');
                    if(fieldset.is(':visible')) {
                        const name = fieldset.find('input[type="radio"]').attr('name');
                        if ($(`input[name="${name}"]:checked`).length === 0) {
                            fieldset.addClass('invalid');
                            isValid = false;
                        }
                    }
                });

                $('#resultados-fieldset').removeClass('invalid');
                $('#resultados-fieldset .radio-row').each(function() {
                    const row = $(this);
                    if (row.is(':visible')) {
                        const name = row.find('input[type="radio"]').attr('name');
                        if ($(`input[name="${name}"]:checked`).length === 0) {
                            isValid = false;
                             $('#resultados-fieldset').addClass('invalid');
                        }
                    }
                });


                if (!isValid) {
                    swal("Atenção!", "Por favor, preencha todos os campos obrigatórios em destaque.", "warning");
                    return;
                }
                
                if (GOOGLE_SCRIPT_URL.includes("SUBSTITUA AQUI")) {
                    swal("Configuração Incompleta!", "A URL do Google Apps Script precisa ser configurada no código Javascript.", "error");
                    return;
                }

                submitButton.prop('disabled', true).html('<i class="fas fa-spinner fa-spin"></i> Processando...');

                for (let i = 1; i <= 4; i++) {
                    const studentRow = $(`#aluno-${i}-row`);
                    if (!studentRow.is(':visible')) {
                        $(`input[name="resultado-aluno${i}"][value="-x-"]`).prop('checked', true);
                    }
                }

                const carimbo = new Date().toLocaleString('pt-BR', { timeZone: 'America/Sao_Paulo' });
                const inicioFormatted = `${$('#data-inicio').val().split('-').reverse().join('/')} ${$('#hora-inicio').val()}`;
                const aulaAplicada = $('#aula-aplicada').val();
                
                let etapaConfirmacao = 'A aula aplicada não foi a Supervisão de Soldados.';
                if (aulaAplicada === 'Supervisão de Soldados') {
                    etapaConfirmacao = $('input[name="etapa-confirmacao"]:checked').val() || 'Não preenchido';
                }

                let provaQueda = 'O aluno dessa aula NÃO caiu';
                if ($('#prova-queda-group').is(':visible')) {
                    provaQueda = $('#prova-queda').val().trim();
                }

                const formData = new FormData();
                formData.append('CARIMBO', carimbo);
                formData.append('NICK_SUPERVISOR', $('#supervisor').val().trim());
                formData.append('AULA_APLICADA', aulaAplicada);
                formData.append('NICKS_ALUNOS', $('#alunos').val().trim());
                formData.append('LOCAL_APLICACAO', $('#local-aplicacao').val());
                formData.append('INICIO', inicioFormatted);
                formData.append('RESULTADO_ALUNO_1', $('input[name="resultado-aluno1"]:checked').val());
                formData.append('RESULTADO_ALUNO_2', $('input[name="resultado-aluno2"]:checked').val());
                formData.append('RESULTADO_ALUNO_3', $('input[name="resultado-aluno3"]:checked').val());
                formData.append('RESULTADO_ALUNO_4', $('input[name="resultado-aluno4"]:checked').val());
                formData.append('ETAPA_CONFIRMACAO', etapaConfirmacao);
                formData.append('PROVA_QUEDA', provaQueda);
                formData.append('COMENTARIOS', $('#comentarios').val().trim());
                formData.append('ACOMPANHAMENTO_TUTOR', $('input[name="acompanhamento-tutor"]:checked').val());

                fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    body: formData,
                })
                .then(response => response.json())
                .then(data => {
                    if (data.result === 'success') {
                        swal("Sucesso!", "Seu relatório foi enviado com sucesso!", "success", { buttons: false, timer: 2500 });
                        form[0].reset();
                        $('.radio-row').slideUp();
                        $('#etapa-confirmacao-group, #prova-queda-group').hide();
                        $('input[name^="resultado-aluno"]').prop('checked', false);
                        setTimeout(() => {
                           window.location.href = SPREADSHEET_REDIRECT_URL;
                        }, 1500);
                    } else {
                        throw new Error(data.message || 'Ocorreu um erro desconhecido.');
                    }
                })
                .catch(error => {
                    console.error("Erro ao enviar para planilha: ", error);
                    swal("Erro!", "Não foi possível enviar o relatório. Verifique sua conexão ou contate o desenvolvedor.", "error");
                })
                .finally(() => {
                    submitButton.prop('disabled', false).html('<i class="fas fa-paper-plane"></i> Enviar Relatório');
                });
            });
             $('.radio-row').hide();
        });
    </script>
</body>
</html>
